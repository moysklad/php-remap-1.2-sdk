<?php
/**
 * GroupsApiTest
 * PHP version 7.4
 *
 * @category Class
 * @package  OpenAPI\Client
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */

/**
 * МойСклад JSON API
 *
 * API для манипуляции с сущностями и создания отчетов в онлайн-сервисе МойСклад.  ## Аутентификация  МойСклад поддерживает аутентификацию по протоколу Basic Auth и с использованием токена доступа: - Basic Auth: заголовок `Authorization` со значением пары `логин:пароль`, закодированным в Base64 - Bearer Token: заголовок `Authorization` со значением `Bearer <Access-Token>`  ## Ограничения  - Не более 45 запросов за 3 секундный период от аккаунта - Не более 5 параллельных запросов от одного пользователя   - Не более 20 параллельных запросов от аккаунта - Не более 20 Мб данных в одном запросе - Максимум 1000 элементов в массиве - Обязательное использование сжатия gzip
 *
 * The version of the OpenAPI document: 1.0.0
 * Generated by: https://openapi-generator.tech
 * Generator version: 7.14.0
 */

/**
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Please update the test case below to test the endpoint.
 */

namespace OpenAPI\Client\Test\Api;

use OpenAPI\Client\Api\GroupsApi;
use OpenAPI\Client\ApiException;
use OpenAPI\Client\Configuration;
use OpenAPI\Client\Model\Group;
use OpenAPI\Client\Model\GroupList;
use OpenAPI\Client\Test\Utils\Asserter;
use OpenAPI\Client\Test\Utils\StringUtil;
use PHPUnit\Framework\Assert;
use PHPUnit\Framework\TestCase;

/**
 * GroupsApiTest Class Doc Comment
 *
 * @category Class
 * @package  OpenAPI\Client
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
class GroupsApiTest extends TestCase
{

    private static GroupsApi $api;

    public static function setUpBeforeClass(): void
    {
        $config = Configuration::getDefaultConfiguration()
            ->setHost(getenv('API_HOST') . '/api/remap/1.2')
            ->setUsername(getenv('API_LOGIN'))
            ->setPassword(getenv('API_PASSWORD'));

        GroupsApiTest::$api = new GroupsApi(null, $config);
    }

         /**
          *  Проверка успешной обработки ответа сервера на получение групп
          */
        public function testEntityGroupGet(): void
        {
            $group1 = new Group();
            $group1->setName("Б Group 1");
            $group1 = GroupsApiTest::$api->entityGroupPost($group1);

            $group2 = new Group();
            $group2->setName("Б Group 2");
            $group2 = GroupsApiTest::$api->entityGroupPost($group2);

            $group3 = new Group();
            $group3->setName("Б Group 3");
            $group3 = GroupsApiTest::$api->entityGroupPost($group3);

            Assert::assertNotSame($group1->getId(), $group2->getId());
            Assert::assertNotSame($group2->getId(), $group3->getId());

            $groupList_12 = GroupsApiTest::$api->entityGroupGet(2, 0);
            Assert::assertInstanceOf(GroupList::class, $groupList_12);
            Asserter::assertMetaCollection($groupList_12->getMeta(), 'group', 4, 2, 'group');
            Asserter::assertJsonHasFields($groupList_12, ['meta' => []], false, 'context.employee');

            $groupList_23 = GroupsApiTest::$api->entityGroupGet(3, 1);
            Assert::assertInstanceOf(GroupList::class, $groupList_23);
            Asserter::assertMetaCollection($groupList_23->getMeta(), 'group', 4, 3, 'group');
            Asserter::assertJsonHasFields($groupList_23, ['meta' => []], false, 'context.employee');
        }

        /**
         *  Проверка обработки ответа сервера на получение группы сопровождаемое ошибкой
         */
        public function testEntityGroupGetWithError(): void
        {
            try {
                GroupsApiTest::$api->entityGroupGet(1, 5, null, "name=test");
                Assert::fail();
            } catch (ApiException $e) {
                Assert::assertEquals(412, $e->getCode());
                Assert::assertNotNull($e->getResponseBody());
            }
        }

        /**
         *  Проверка успешной обработки ответа сервера в случае ошибки
         */
        public function testEntityGroupIdGet()
        {
            $groupReq = new Group();

            // простые флаги и строки
            $groupReq->setName("Тестовый отдел " . StringUtil::randomUuid());

            $groupResp = GroupsApiTest::$api->entityGroupPost($groupReq);
            $groupId = $groupResp->getId();
            Assert::assertNotNull($groupId);
            Asserter::assertMeta($groupResp->getMeta(), $groupId, 'group');

            Assert::assertSame($groupReq->getName(), $groupResp->getName());
            Assert::assertNotNull($groupResp->getAccountId());
            Assert::assertNotNull($groupResp->getIndex());
        }

        /**
         *  Проверка обработки ответа сервера на получение группы сопровождаемое ошибкой
         */
        public function testEntityGroupIdGetWithError()
        {
            try {
                GroupsApiTest::$api->entityGroupIdGet(StringUtil::randomUuid());
                Assert::fail();
            } catch (ApiException $e) {
                Assert::assertEquals(404, $e->getCode());
                Assert::assertNotNull($e->getResponseBody());
            }
        }

        /**
         *  Проверка обработки ответа сервера на создание группы сопровождаемое ошибкой
         */
        public function testEntityGroupPostWithError()
        {
            try {
                $group1 = new Group();
                GroupsApiTest::$api->entityGroupPost($group1);
                Assert::fail();
            } catch (ApiException $e) {
                Assert::assertEquals(412, $e->getCode());
                Assert::assertNotNull($e->getResponseBody());
            }
        }

        /**
         *  Проверка успешной обработки ответа сервера на обновление группы
         */
        public function testEntityGroupIdPut()
        {
            $createGroup = new Group();
            $createGroup->setName("Group Old");
            $createGroup = GroupsApiTest::$api->entityGroupPost($createGroup);

            $updateGroup = new Group();
            $updateGroup->setName("Group New");
            $updateGroup = GroupsApiTest::$api->entityGroupIdPut($createGroup->getId(), $updateGroup);

            Assert::assertSame($createGroup->getId(), $updateGroup->getId());
            Assert::assertSame("Group New", $updateGroup->getName());
        }

        /**
         *  Проверка успешной обработки ответа сервера удаления группы
         */
        public function testEntityGroupIdDelete()
        {
            $group = new Group();
            $group->setName("Group testEntityGroupIdDelete");
            $group = GroupsApiTest::$api->entityGroupPost($group);
            $resp = GroupsApiTest::$api->entityGroupIdDeleteWithHttpInfo($group->getId());
            Assert::assertEquals(200, $resp[1]);
        }

        /**
         *  Проверка обработки ответа сервера удаления группы сопровождаемое ошибкой
         */
        public function testEntityGroupIdDeleteWithError()
        {
            try {
                GroupsApiTest::$api->entityGroupIdDelete(StringUtil::randomUuid());
                Assert::fail();
            } catch (ApiException $e) {
                Assert::assertEquals(404, $e->getCode());
                Assert::assertNotNull($e->getResponseBody());
            }
        }
    }
